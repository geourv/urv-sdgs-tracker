<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Wordcloud per facultat</title>
  <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.1.1/src/wordcloud2.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    canvas { width: 100%; height: 600px; border: 1px solid #ccc; display: block; margin-top: 1rem; }
    label { font-weight: bold; margin-right: 0.5rem; }
    select { font-size: 1rem; padding: 0.3rem; }
  </style>
</head>
<body>

<h2>Wordcloud per facultat</h2>

<label for="facultySelect">Selecciona una facultat:</label>
<select id="facultySelect"></select>

<canvas id="wordcloud"></canvas>

<script>
  const canvas = document.getElementById("wordcloud");
  const facultySelect = document.getElementById("facultySelect");

  function resizeCanvas(canvas, width, height) {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = width * ratio;
    canvas.height = height * ratio;
    canvas.style.width = width + "px";
    canvas.style.height = height + "px";
    const ctx = canvas.getContext("2d");
    ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  }

  function drawWordCloud(sdgs) {
    const wordList = Object.entries(sdgs)
      .filter(([word, count]) => typeof count === 'number')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 100); // només les 100 paraules més freqüents

    resizeCanvas(canvas, 800, 600);

    WordCloud(canvas, {
      list: wordList,
      gridSize: 4,
      weightFactor: (size) => Math.pow(size, 1.2),
      fontFamily: 'Arial',
      color: 'random-dark',
      backgroundColor: '#fff',
      rotateRatio: 0,
      drawOutOfBound: false,
      shrinkToFit: true,
      origin: [canvas.width / 2, canvas.height / 2]
    });
  }

  let allFaculties = [];

  fetch("faculties_features_data.json")
    .then(response => response.json())
    .then(data => {
      allFaculties = data;

      data.forEach((item, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = item.faculty;
        facultySelect.appendChild(option);
      });

      drawWordCloud(data[0].sdgs); // per defecte, la primera facultat
    })
    .catch(error => {
      console.error("Error carregant el JSON:", error);
      alert("No s'ha pogut carregar el fitxer JSON.");
    });

  facultySelect.addEventListener("change", function() {
    const selectedIndex = parseInt(this.value);
    const selectedFaculty = allFaculties[selectedIndex];
    drawWordCloud(selectedFaculty.sdgs);
  });
</script>

</body>
</html>

